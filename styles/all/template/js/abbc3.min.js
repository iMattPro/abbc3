var requestRunning=false;var bbwizard;(function($){"use strict";bbwizard=function(href,bbcode){if(!requestRunning){var wizard=$("#bbcode_wizard"),modal=$("#darkenwrapper");if(!wizard.is(":visible")){requestRunning=true;var $loadingIndicator=phpbb.loadingIndicator();$.ajax({url:href,dataType:"html",beforeSend:function(){wizard.hide().empty()},success:function(data){modal.fadeIn("fast");wizard.append(data).fadeIn("fast").find("#bbcode_wizard_submit").attr("data-bbcode",bbcode)},error:function(){bbfontstyle("["+bbcode+"]","[/"+bbcode+"]")},complete:function(){requestRunning=false;if($loadingIndicator&&$loadingIndicator.is(":visible")){$loadingIndicator.fadeOut(phpbb.alertTime)}}})}}};var bbinsert=function(bbopen,bbclose){var textarea;if(is_ie){textarea=document.forms[form_name].elements[text_name];textarea.focus();baseHeight=document.selection.createRange().duplicate().boundingHeight}insert_text(bbopen+bbclose);if(is_ie){var text=bbopen+bbclose;var pos=textarea.innerHTML.indexOf(text);if(pos>0){var new_pos=pos+text.length;var range=textarea.createTextRange();range.move("character",new_pos);range.select();storeCaret(textarea);textarea.focus()}}};$(function(){var body=$("body");body.on("click",".spoilbtn",function(event){event.preventDefault();var trigger=$(this),spoiler=trigger.closest("div").next(".spoilcontent");spoiler.slideToggle("fast",function(){trigger.text(spoiler.is(":visible")?trigger.data("hide"):trigger.data("show"))})});var wizard=$("#bbcode_wizard"),modal=$("#darkenwrapper");var closeWizard=function(){if(wizard.is(":visible")){wizard.fadeOut("fast");modal.fadeOut("fast")}};body.on("click",closeWizard).on("keyup",function(event){if(event.key==="Escape"||event.keyCode===27){event.preventDefault();closeWizard()}});wizard.on("click","#bbcode_wizard_submit",function(event){event.preventDefault();var bbcode=$(this).data("bbcode");switch(bbcode){case"url":var link=$("#bbcode_wizard_link").val(),description=$("#bbcode_wizard_description").val();bbinsert("["+bbcode+(description.length?"="+link:"")+"]"+(description.length?description:link)+"","[/"+bbcode+"]");break;case"bbvideo":case"media":bbinsert("["+bbcode+"]"+$("#bbvideo_wizard_link").val()+"","[/"+bbcode+"]");break}closeWizard()}).on("click","#bbcode_wizard_cancel",function(event){event.preventDefault();closeWizard()}).on("change","#bbvideo_wizard_sites",function(){$("#bbvideo_wizard_example").val($(this).val())}).on("click",function(event){event.stopPropagation()})})})(jQuery);