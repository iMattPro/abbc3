<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd">
	<header>
		<license><![CDATA[http://opensource.org/licenses/gpl-license.php GNU General Public License v2]]></license>

		<title lang="en"><![CDATA[Advanced BBCode Box 3 (aka ABBC3) - Update from 1.0.12 to 3.0.7-PL1]]></title>

		<description lang="en"><![CDATA[This file provides instructions for upgrading ABBC3 MOD from version 1.0.12 to version 3.0.7-PL1]]></description>

		<author-notes lang="en"><![CDATA[
	Basically this instructions change :

	For templates (.html) :
	Every :
		<!-- MOD : MSSTI ABBC3 (V1.0.12) - Start //--> 
	With :
		<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->
	and also, every :
		<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->
	With :
		<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //--> 

	For codes (.php) :
	Every :
		// MOD : MSSTI ABBC3 (V1.0.12) - Start
	With :
		// MOD : MSSTI ABBC3 - Start
	and also, every :
		// MOD : MSSTI ABBC3 (V1.0.12) - End
	With :
		// MOD : MSSTI ABBC3 - End

	But also includes one addition and one suppression, and fix some spaces between tokens.

	-------------------------------------------------------------------

	See the main install file for any additional information about the MOD.

	You will have to make this change to ALL themes you have installed, based off Prosilver and Subsilver2.

	-------------------------------------------------------------------
	IMPORTANT !

	Before made any changes, makes sure your template is stored into "filesystem"
	    ACP -> STYLES -> STYLE COMPONENTS -> Templates : subsilver2 -> Details

	If you do not want to change from "Database" to "Filesystem",
	you must do next changes within your ACP :
	    ACP -> STYLES -> STYLE COMPONENTS -> Templates : subsilver2 -> Edit

	-------------------------------------------------------------------

	Before adding this MOD to your forum, you should back up all files and databases related to this MOD.]]></author-notes>

		<author-group>
			<author>
				<realname><![CDATA[Gabriel]]></realname>
				<username><![CDATA[leviatan21]]></username>
				<homepage><![CDATA[http://www.mssti.com/phpbb3/]]></homepage>
				<email><![CDATA[info@mssti.com]]></email>
				<contributions-group>
					<contributions status="current" from="2008-01-10" position="Developer"/>
				</contributions-group>
			</author>
		</author-group>

		<mod-version>3.0.7</mod-version>

		<installation>
			<level>intermediate</level>
			<time>1200</time>
			<target-version>3.0.7-PL1</target-version>
		</installation>

		<link-group>
			<link type="parent" href="../install_ABBC3.xml" lang="en">Code change</link>
			<link type="contrib" href="../root/install_abbc3.php" lang="en">Database update</link>
		</link-group>
	</header>

	<action-group>

		<copy>
			<file from="root/abbcode_page.php" to="abbcode_page.php"/>
			<file from="root/adm/style/*.*" to="adm/style/*.*"/>
			<file from="root/images/*.*" to="images/*.*"/>
			<file from="root/includes/*.*" to="includes/*.*"/>
			<file from="root/install_abbc3.php" to="install_abbc3.php"/>
			<file from="root/language/en/mods/*.*" to="language/en/mods/*.*"/>
			<file from="root/styles/abbcode/*.*" to="styles/abbcode/*.*"/>
			<file from="root/styles/prosilver/template/*.*" to="styles/prosilver/template/*.*"/>
			<file from="root/styles/subsilver2/template/*.*" to="styles/subsilver2/template/*.*"/>
		</copy>

		<php-installer><![CDATA[install_abbc3.php]]></php-installer>

		<open src="adm/style/acp_users_signature.html">
			<edit>
				<find><![CDATA[<p>{SIGNATURE_PREVIEW}</p>]]></find>
				<action type="replace-with"><![CDATA[<div id="sig" class="signature"><p>{SIGNATURE_PREVIEW}</p></div>]]></action>
			</edit>

			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - Start //-->
		<!-- IF S_ABBC3_MOD -->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->
		<!-- IF S_ABBC3_MOD -->]]></action>
			</edit>

			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->

		<dl>

<!-- MOD : MSSTI ABBC3 (V1.0.12) - Start //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //-->

		<dl>

<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->]]></action>
			</edit>

			<edit>
				<find><![CDATA[			<dt style="width: 100%;"><textarea name="signature" id="signature" rows="10" cols="60" style="width: 100%; height: 300px;"]]></find>
				<inline-edit>
					<inline-find><![CDATA[style="width: 100%; height: 300px;"]]></inline-find>
					<inline-action type="replace-with"><![CDATA[style="width: 99%; height: 300px;"]]></inline-action>
				</inline-edit>
			</edit>

			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //-->]]></action>
			</edit>
		</open>

		<open src="adm/style/overall_header.html">
			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - Start //-->
<!-- INCLUDE abbcode_header.html -->
<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->
<!-- INCLUDE abbcode_header.html -->
<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //-->]]></action>
			</edit>
		</open>

		<open src="adm/style/simple_header.html">
			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - Start //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->]]></action>
			</edit>

			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //-->]]></action>
			</edit>
		</open>

		<open src="includes/bbcode.php">
			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start
if (!class_exists('abbcode'))
{
	include($phpbb_root_path . 'includes/abbcode.' . $phpEx);
}
/**
* BBCode class
* @package phpBB3
*/
class bbcode extends abbcode
// MOD : MSSTI ABBC3 (V1.0.12) - end]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start
if (!class_exists('abbcode'))
{
	include($phpbb_root_path . 'includes/abbcode.' . $phpEx);
}
/**
* BBCode class
* @package phpBB3
*/
// class bbcode
class bbcode extends abbcode
// MOD : MSSTI ABBC3 - end]]></action>
			</edit>

			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start

		// Try to avoid duplicates anchor ID's inside quotes
		if ( preg_match('#\[quote(?:=&quot;(.*?)&quot;)?:' . $this->bbcode_uid . '\](.*?)?\[anchor(=(.*?)([\s]?))?#is', $message) )
		{
			$message = preg_replace('#(\[quote(?:=&quot;(.*?)&quot;)?:' . $this->bbcode_uid . '\](.*?))?\[anchor((=|)(.*?)([\s]))?#is',"$1[anchor$5quoted$6$7", $message);
		}
// MOD : MSSTI ABBC3 (V1.0.12) - End]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start

		// Try to avoid duplicates anchor ID's inside quotes
		if (preg_match('#\[quote(?:=&quot;(.*?)&quot;)?:' . $this->bbcode_uid . '\](.*?)?\[anchor(=(.*?)([\s]?))?#is', $message))
		{
			$message = preg_replace('#(\[quote(?:=&quot;(.*?)&quot;)?:' . $this->bbcode_uid . '\](.*?))?\[anchor((=|)(.*?)([\s]))?#is',"$1[anchor$5quoted$6$7", $message);
		}
// MOD : MSSTI ABBC3 - End]]></action>
			</edit>

			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start
			$this->template_filename2 = $phpbb_root_path . 'styles/' . $user->theme['template_path'] . '/template/abbcode.html';]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start
			$this->template_filename2 = $phpbb_root_path . 'styles/' . $user->theme['template_path'] . '/template/abbcode.html';]]></action>
			</edit>

			<edit>
				<find><![CDATA[if (isset($template->orig_tpl_inherits_id) && $template->orig_tpl_inherits_id)]]></find>
				<action type="replace-with"><![CDATA[if (isset($user->theme['template_inherits_id']) && $user->theme['template_inherits_id'])]]></action>
				<comment lang="en">If you don't find the next line, don't worry probably you never install the 3.0.6 patch. Procede with the next step.</comment>
			</edit>

			<edit>
				<find><![CDATA[			}
// MOD : MSSTI ABBC3 (V1.0.12) - End]]></find>
				<action type="replace-with"><![CDATA[			}
// MOD : MSSTI ABBC3 - End]]></action>
			</edit>

			<edit>
				<find><![CDATA[		$bitfield = new bitfield($this->bbcode_bitfield);
		$bbcodes_set = $bitfield->get_all_set();

		foreach ($bbcodes_set as $bbcode_id)]]></find>
				<action type="before-add"><![CDATA[// MOD : MSSTI ABBC3 - Start
		$abbcode = new abbcode();
// MOD : MSSTI ABBC3 - end
]]></action>
				<comment lang="en">IMPORTANT ! change </comment>
			</edit>

			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start
			$sql .= ' AND bbcode_match <> "." ';
// MOD : MSSTI ABBC3 (V1.0.12) - End]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start
			$sql .= ' AND bbcode_match <> "." ';
// MOD : MSSTI ABBC3 - End]]></action>
			</edit>

			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start
							'#\[url:$uid\](ed2k://\|(file|server|serverlist|friend)(|\|[^\\/\|:<>\*\?\"]+?)\|(.*?)\|/?)\[/url:$uid\]#sie'		=> "\$this->ed2k_pass( \$bbcode_id, '\$1', '' )",
							'#\[url=(ed2k://\|(file|server|serverlist|friend)(|\|[^\\/\|:<>\*\?\"]+?)\|(.*?)\|/?):$uid\](.*?)\[/url:$uid\]#sie'	=> "\$this->ed2k_pass( \$bbcode_id, '\$1', '\$5' )",
// MOD : MSSTI ABBC3 (V1.0.12) - End]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start
							'#\[url:$uid\](ed2k://\|(file|server|serverlist|friend)(|\|[^\\/\|:<>\*\?\"]+?)\|(.*?)\|/?)\[/url:$uid\]#sie'		=> "\$this->ed2k_pass( \$bbcode_id, '\$1', '' )",
							'#\[url=(ed2k://\|(file|server|serverlist|friend)(|\|[^\\/\|:<>\*\?\"]+?)\|(.*?)\|/?):$uid\](.*?)\[/url:$uid\]#sie'	=> "\$this->ed2k_pass( \$bbcode_id, '\$1', '\$5' )",
// MOD : MSSTI ABBC3 - End]]></action>
			</edit>

			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start
						$user->add_lang('mods/abbcode');
// MOD : MSSTI ABBC3 (V1.0.12) - End]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start
						$user->add_lang('mods/abbcode');
// MOD : MSSTI ABBC3 - End]]></action>
			</edit>

			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start
			if (($tpl2 = file_get_contents($this->template_filename2)) === false)]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start
			if (($tpl2 = file_get_contents($this->template_filename2)) === false)]]></action>
			</edit>

			<edit>
				<find><![CDATA[				$tpl .= $tpl2;
			}
// MOD : MSSTI ABBC3 (V1.0.12) - End]]></find>
				<action type="replace-with"><![CDATA[				$tpl .= $tpl2;
			}
// MOD : MSSTI ABBC3 - End]]></action>
			</edit>
		</open>

		<open src="includes/constants.php">
			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) Clicks Counter feature - Start]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 Clicks Counter feature - Start]]></action>
			</edit>

			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) Clicks Counter feature - End]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 Clicks Counter feature - End]]></action>
			</edit>
		</open>

		<open src="includes/functions.php">
			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start
	// Safety check
	if ($config['ABBC3_MOD'] = (isset($config['ABBC3_MOD']) ? $config['ABBC3_MOD'] : false))
	{
		if (!class_exists('abbcode'))
		{
			include($phpbb_root_path . 'includes/abbcode.' . $phpEx);
		}
		$abbcode = new abbcode();
		$abbcode->abbcode_init();
	}
// MOD : MSSTI ABBC3 (V1.0.12) - End]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start
	if (defined('IN_ABBC3'))
	{
		$user->add_lang('mods/abbcode');
	}
// MOD : MSSTI ABBC3 - End]]></action>
			</edit>
		</open>

		<open src="includes/functions_display.php">
			<edit>
				<find><![CDATA[function display_custom_bbcodes( $abbc3 = true )]]></find>
				<action type="replace-with"><![CDATA[function display_custom_bbcodes($abbc3 = true)]]></action>
			</edit>

			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start
	global $config, $mode;

	if ( $abbc3 && @$config['ABBC3_MOD'] )
	{
		if (!class_exists('abbcode'))
		{
			global $phpbb_root_path, $phpEx;
			include($phpbb_root_path . 'includes/abbcode.' . $phpEx);
		}
		$abbcode = new abbcode();
		$abbcode->abbcode_init();
		$abbcode->abbcode_display( $mode );

		$sql = 'SELECT bbcode_id, bbcode_tag, bbcode_helpline
			FROM ' . BBCODES_TABLE . '
			WHERE display_on_posting = 1 AND abbcode = 0 AND bbcode_image = "" 
			ORDER BY bbcode_tag';
	}
	else
	{
		$template->assign_vars(array('S_ABBC3_DISABLED' => true));]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start
	global $config, $mode, $abbcode;

	if ($abbc3 && @$config['ABBC3_MOD'])
	{
		// We need to check if ABBC3 is property initialized
		if (!class_exists('abbcode'))
		{
			global $phpbb_root_path, $phpEx;

			include($phpbb_root_path . 'includes/abbcode.' . $phpEx);
		}

		$abbcode->abbcode_init();
		$abbcode->abbcode_display($mode);

		$sql = 'SELECT bbcode_id, bbcode_tag, bbcode_helpline
			FROM ' . BBCODES_TABLE . '
			WHERE display_on_posting = 1 AND abbcode = 0 AND bbcode_image = "" 
			ORDER BY bbcode_tag';
	}
	else
	{
		$template->assign_vars(array('S_ABBC3_DISABLED' => true));

]]></action>
			</edit>

			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - End]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - End]]></action>
			</edit>
		</open>

		<open src="includes/message_parser.php">
			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start
			$sql .= ' WHERE bbcode_match <> "." ';
// MOD : MSSTI ABBC3 (V1.0.12) - End]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start
			$sql .= ' WHERE bbcode_match <> "." ';
// MOD : MSSTI ABBC3 - End]]></action>
			</edit>

			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start
				'bbcode_group'	=> $row['bbcode_group'],
// MOD : MSSTI ABBC3 (V1.0.12) - End]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start
				'bbcode_group'	=> $row['bbcode_group'],
// MOD : MSSTI ABBC3 - End]]></action>
			</edit>

			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start
		// Check ABBC3 groups permission
		foreach ($this->bbcodes as $bbcode_name => $bbcode_data)
		{
			if (isset($bbcode_data['bbcode_group']) && $bbcode_data['bbcode_group'] && !$this->abbode_phpbb_auth($bbcode_data['bbcode_group']))
			{
				$this->bbcodes[$bbcode_name]['disabled'] = true;
			}
		}
// MOD : MSSTI ABBC3 (V1.0.12) - End]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start
		// Check phpbb permissions status
		// Check ABBC3 groups permission
		// try to make it as quicky as it can be
		foreach ($this->bbcodes as $bbcode_name => $bbcode_data)
		{
			$auth_tag = preg_replace('#\=(.*)?#', '', strtoupper(trim($bbcode_name)));
			if ((isset($bbcode_data['bbcode_group']) && $bbcode_data['bbcode_group']) || in_array($auth_tag, $this->need_permissions))
			{
				if (!$this->abbcode_permissions($auth_tag, (isset($bbcode_data['bbcode_group']) ? $bbcode_data['bbcode_group'] : 0)))
				{
					$this->bbcodes[$bbcode_name]['disabled'] = true;
				}
			}
		}
// MOD : MSSTI ABBC3 - End]]></action>
			</edit>

		</open>

		<open src="includes/acp/acp_bbcodes.php">
			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start
					$sql = 'SELECT MAX(bbcode_order) as max_bbcode_order
						FROM ' . BBCODES_TABLE;
					$result = $db->sql_query($sql);
					$row = $db->sql_fetchrow($result);
					$db->sql_freeresult($result);
					$bbcode_order = $row['max_bbcode_order'] + 1;
					$sql_ary['bbcode_order'] = (int) $bbcode_order;
// MOD : MSSTI ABBC3 (V1.0.12) - End]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start
						$sql = 'SELECT MAX(bbcode_order) as max_bbcode_order
							FROM ' . BBCODES_TABLE;
						$result = $db->sql_query($sql);
						$row = $db->sql_fetchrow($result);
						$db->sql_freeresult($result);
						$bbcode_order = $row['max_bbcode_order'] + 1;
						$sql_ary['bbcode_order'] = (int) $bbcode_order;
// MOD : MSSTI ABBC3 - End]]></action>
			</edit>

			<edit>
				<find><![CDATA[						WHERE abbcode = 0 ORDER BY bbcode_tag';]]></find>
				<action type="replace-with"><![CDATA[			WHERE abbcode = 0 ORDER BY bbcode_tag';]]></action>
			</edit>
		</open>

		<open src="language/en/acp/common.php">
			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - Start]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - Start]]></action>
			</edit>

			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 (V1.0.12) - End]]></find>
				<action type="replace-with"><![CDATA[// MOD : MSSTI ABBC3 - End]]></action>
			</edit>
		</open>

		<open src="styles/prosilver/template/overall_header.html">
			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - Start //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->]]></action>
			</edit>

			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //-->]]></action>
			</edit>
		</open>

		<open src="styles/prosilver/template/posting_buttons.html">
			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - Start //-->
<!-- IF S_ABBC3_MOD and not S_ABBC3_DISABLED -->
	<!-- INCLUDE posting_abbcode_buttons.html -->
<!-- ELSE -->
<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->
<!-- IF S_ABBC3_MOD and not S_ABBC3_DISABLED -->
	<!-- INCLUDE posting_abbcode_buttons.html -->
<!-- ELSE -->
<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //-->]]></action>
			</edit>

			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - Start //-->
<!-- ENDIF -->
<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->
<!-- ENDIF -->
<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //-->]]></action>
			</edit>
		</open>

		<open src="styles/prosilver/template/posting_preview.html">
			<edit>
				<find><![CDATA[<!-- IF PREVIEW_SIGNATURE --><div class="signature">{PREVIEW_SIGNATURE}</div><!-- ENDIF -->]]></find>
				<inline-edit>
					<inline-find><![CDATA[ class="signature"]]></inline-find>
					<inline-action type="before-add"><![CDATA[ id="sig"]]></inline-action>
				</inline-edit>
			</edit>
		</open>

		<open src="styles/prosilver/template/ucp_profile_signature.html">
			<edit>
				<find><![CDATA[<div class="signature" style="border-top:none; margin-top: 0; ">{SIGNATURE_PREVIEW}</div>]]></find>
				<inline-edit>
					<inline-find><![CDATA[ class="signature"]]></inline-find>
					<inline-action type="before-add"><![CDATA[ id="sig"]]></inline-action>
				</inline-edit>
			</edit>
		</open>

		<open src="styles/prosilver/template/simple_header.html">
			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - Start //-->
]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->]]></action>
			</edit>

			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //-->]]></action>
			</edit>
		</open>

		<open src="styles/prosilver/theme/stylesheet.css">
			<edit>
				<find><![CDATA[/** MOD : MSSTI ABBC3 (V1.0.12) Quote block fix - Start **/
blockquote { background-image: none; }
blockquote div cite { margin-left: 0px; padding-left: 20px; background-image: url("{T_THEME_PATH}/images/quote.gif"); background-position: 0 3px; background-repeat: no-repeat; }
blockquote.uncited { background-image: url("{T_THEME_PATH}/images/quote.gif"); background-position: 6px 8px; background-repeat: no-repeat; }
/** MOD : MSSTI ABBC3 (V1.0.12) Quote block fix - End **/]]></find>
				<action type="replace-with"><![CDATA[]]></action>
				<comment lang="en">Just delete this lines, and see the root/contrib/add-on_MSSTI_ABBC3_quote_behaviour.xml file</comment>
			</edit>
		</open>

		<open src="styles/subsilver2/template/overall_header.html">
			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - Start //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->]]></action>
			</edit>

			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //-->]]></action>
			</edit>
		</open>

		<open src="styles/subsilver2/template/posting_body.html">
			<edit>
				<find><![CDATA[<!-- IF S_BBCODE_ALLOWED and not S_ABBC3_COLOR  -->]]></find>
				<action type="replace-with"><![CDATA[<!-- IF S_BBCODE_ALLOWED and not S_ABBC3_COLOR -->]]></action>
			</edit>
		</open>

		<open src="styles/subsilver2/template/posting_buttons.html">
			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - Start //-->
	<!-- IF S_ABBC3_MOD and not S_ABBC3_DISABLED -->
		<!-- INCLUDE posting_abbcode_buttons.html -->
	<!-- ELSE -->
<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->
	<!-- IF S_ABBC3_MOD and not S_ABBC3_DISABLED -->
		<!-- INCLUDE posting_abbcode_buttons.html -->
	<!-- ELSE -->
<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //-->]]></action>
			</edit>

			<edit>
				<find><![CDATA[		</select></span>
	<!-- ENDIF -->
<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->]]></find>
				<action type="replace-with"><![CDATA[		</select></span>
<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->
	<!-- ENDIF -->
<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //-->]]></action>
			</edit>

			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - Start //-->
<!-- IF not S_ABBC3_MOD or S_ABBC3_DISABLED -->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->
<!-- IF not S_ABBC3_MOD or S_ABBC3_DISABLED -->]]></action>
			</edit>

			<edit>
				<find><![CDATA[<!-- ENDIF -->
<!-- ENDIF -->
<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- ENDIF -->
<!-- ENDIF -->
<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //-->]]></action>
			</edit>
		</open>

		<open src="styles/subsilver2/template/posting_preview.html">
			<edit>
				<find><![CDATA[<!-- IF PREVIEW_SIGNATURE -->]]></find>
				<find><![CDATA[<span class="postbody">]]></find>
				<inline-edit>
					<inline-find><![CDATA[ class="postbody"]]></inline-find>
					<inline-action type="before-add"><![CDATA[ id="sig"]]></inline-action>
				</inline-edit>
			</edit>
		</open>

		<open src="styles/subsilver2/template/simple_header.html">
			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - Start //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - Start //-->]]></action>
			</edit>

			<edit>
				<find><![CDATA[<!-- MOD : MSSTI ABBC3 (V1.0.12) - End //-->]]></find>
				<action type="replace-with"><![CDATA[<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} - End //-->]]></action>
			</edit>
		</open>

		<open src="styles/subsilver2/template/ucp_pm_viewmessage.html">
			<edit>
				<find><![CDATA[				<!-- IF SIGNATURE -->]]></find>
				<find><![CDATA[					<span class="postbody">]]></find>
				<inline-edit>
					<inline-find><![CDATA[ class="postbody"]]></inline-find>
					<inline-action type="before-add"><![CDATA[ id="sig"]]></inline-action>
				</inline-edit>				
			</edit>
		</open>

		<open src="styles/subsilver2/template/ucp_profile_signature.html">
			<edit>
				<find><![CDATA[<td class="row1" colspan="2"><div class="postbody" style="padding: 6px;">{SIGNATURE_PREVIEW}</div></td>]]></find>
				<inline-edit>
					<inline-find><![CDATA[ class="postbody"]]></inline-find>
					<inline-action type="before-add"><![CDATA[ id="sig"]]></inline-action>
				</inline-edit>
			</edit>
		</open>

		<diy-instructions lang="en"><![CDATA[IMPORTANT !

OVERWRITE all your previous files with the new ones!

Please make sure of it, some FTP programs don't do it fine.

Makes sure you follow the DIY instruction in the main Install_ABBC3.xml file.]]></diy-instructions>
	</action-group>
</mod>